# 医療×ITニュース自動配信システム（PR TIMES → Slack）仕様書

**バージョン:** 1.0  
**作成日:** 2025-xx-xx  
**作成者:** （記入）

---

## 1. 目的

PR TIMES の記事から **「医療 × IT」領域のニュースのみを自動抽出**し、  
Slack チャンネル **<#C09V641HFNX>** に **1日3回まとめて配信**することで、効率的かつ継続的な情報収集を支援する。

---

## 2. システム概要

### 2.1 全体構成

| 項目 | 内容 |
|---|---|
| 情報源 | PR TIMES の RSS（医療/ヘルスケア・IT関連カテゴリ） |
| 抽出条件 | タイトル・概要に「医療系キーワード」と「IT系キーワード」を両方含む記事 |
| 実行環境 | Python スクリプト + cron による定期実行 |
| 通知先 | Slack Incoming Webhook 経由で **<#C09V641HFNX>** に投稿 |
| 配信頻度 | 1日3回（09:00 / 15:00 / 21:00 JST） |

### 2.2 処理フロー

1. PR TIMES の RSS から記事一覧を取得
2. 医療・IT双方のキーワードを含む記事のみ抽出
3. すでに配信済みの記事（URL）を除外
4. 抽出された新規記事を 1回のメッセージにまとめる
5. Slack Webhook を通じてチャンネル **<#C09V641HFNX>** に投稿
6. 今回配信した記事URLを「配信済みリスト」として保存

```text
PR TIMES RSS
   ↓（定期取得）
Python スクリプト
   ↓（キーワードフィルタ）
配信済みチェック
   ↓（新規のみ抽出）
Slack Webhook
   ↓
Slack チャンネル <#C09V641HFNX>
```

---

## 3. 機能要件

### 3.1 記事取得機能

* PR TIMES が提供する RSS を利用して記事を取得する。
* 対象とする RSS（例：運用時に確定）
  * 医療・ヘルスケア関連カテゴリ
  * IT・テクノロジー関連カテゴリ
* 1回の実行で最新の複数件を取得する。
* 取得対象の項目：
  * タイトル
  * URL
  * 公開日時
  * 概要（取得可能な場合）

### 3.2 フィルタリング機能

* 日本語の記事のみを前提とする（PR TIMES の仕様上、ほぼ全て日本語）。
* 記事のタイトルおよび概要テキストに対し、以下双方のキーワードを含むかを判定する。

#### 3.2.1 医療系キーワード（例）

* 「医療」
* 「ヘルスケア」
* 「診療」
* 「病院」
* 「歯科」
* 「看護」
* 「クリニック」
* 「製薬」

#### 3.2.2 IT系キーワード（例）

* 「AI」
* 「IT」
* 「DX」
* 「デジタル」
* 「電子カルテ」
* 「システム」
* 「SaaS」
* 「クラウド」
* 「アプリ」

#### 3.2.3 判定ロジック

* 医療系キーワード群のうち **いずれか1つ以上** が含まれている
* かつ IT系キーワード群のうち **いずれか1つ以上** が含まれている

```text
( 医療系キーワードの OR ) AND ( IT系キーワードの OR )
```

* NG/除外ワード（必要に応じて追加）：
  * 例：「美容整形」「ダイエットサプリ」「エステ」等、医療ヘルスケアではあるが IT要素が薄いものを除外するために運用で拡張。

### 3.3 重複防止機能

* 過去に Slack に配信した記事 URL をローカルのストレージに保存する。
  * 保存形式：JSON ファイル または SQLite（いずれか1つに決定）
* 新たに抽出した記事のうち、URL が保存済みのものは「配信不要」とする。
* 配信後、今回新たに送信した記事の URL を保存に追加する。

### 3.4 Slack通知機能

* Slack の Incoming Webhook URL を使用してメッセージ投稿を行う。
* 投稿先チャンネルは **<#C09V641HFNX>**（ワークスペース側で設定）。
* 投稿フォーマット（例）：

```text
🩺🤖 PR TIMES 医療×ITニュースまとめ（{{配信日時}}）

・{{タイトル1}}
  {{URL1}}

・{{タイトル2}}
  {{URL2}}

...
```

* メッセージ本文の要件：
  * 1実行あたり、該当記事を1つのメッセージにまとめて投稿する（記事ごとに個別投稿しない）。
  * 記事が1件もない場合は以下の文言を送信する：

```text
🩺🤖 本時間帯の PR TIMES 医療×IT 新着はありませんでした。
```

### 3.5 スケジュール実行機能

* cron などのジョブスケジューラで 1日3回自動実行する。

| 実行時刻（JST） | 想定処理内容 |
| --- | --- |
| 09:00 | 前回実行以降に公開された記事を取得し、配信 |
| 15:00 | 同上 |
| 21:00 | 同上 |

* 1回の実行は「前回実行以降に追加された記事」が対象になる想定（重複排除機能と組み合わせて運用）。

---

## 4. 非機能要件

### 4.1 性能・スケーラビリティ

* 実行時間は 1回あたり 1分以内を目安とする。
* 1回の配信あたりの記事件数は数十件以内を想定（PR TIMESの更新頻度ベース）。
* 大量の記事がヒットする場合でも、メッセージ長が Slack の制限に収まるように件数の上限を設けること（例：最大20件/回）。

### 4.2 信頼性・可用性

* ジョブ実行に失敗した場合でも、次回の実行により新規記事が拾えるように、「処理自体が失敗してもストレージを破壊しない」設計とする。
* RSS 取得エラー時などは、例外をログに出力し、Slackへの通知は省略する（※必要であれば「エラー通知」を追加）。

### 4.3 保守性

* 医療系・IT系キーワード、除外キーワードは設定ファイルまたはコード上部の定数としてまとめておき、編集しやすくする。
* PR TIMES の RSS URL も同様に定数で管理し、カテゴリ追加・変更が容易なようにする。

### 4.4 セキュリティ

* Slack Webhook URL は **環境変数** や `.env` ファイルで外部化し、ソースコードに直書きしない。
* 当システムは公開されていないRSSからの読み取りと Slack への投稿のみを行い、ユーザーからの外部入力は受け付けないため、インジェクションやXSS等のリスクは低い。

---

## 5. システム構成

### 5.1 ファイル構成（例）

| ファイル名 | 役割 |
| --- | --- |
| `main.py` | エントリーポイント。全処理を順に呼び出す。 |
| `fetcher.py` | PR TIMES の RSS から記事を取得するモジュール。 |
| `filter.py` | キーワードに基づくフィルタリング処理を行うモジュール。 |
| `storage.py` | 配信済みURLの保存・読み込み機能を提供するモジュール。 |
| `notifier.py` | Slack Webhook へのメッセージ送信機能を提供するモジュール。 |
| `config.py` | キーワード・RSS URL・Slack設定などの定数をまとめる設定ファイル。 |

※ 小規模であれば `main.py` に集約してもよいが、拡張性を考えてモジュール分割する。

---

## 6. データ管理仕様

### 6.1 配信済み記事管理

* データ項目：
  * 記事URL（主キー）
  * 初回配信日時（任意）

#### 6.1.1 JSON形式の例

```json
{
  "https://prtimes.jp/main/html/rd/p/000000001.000000000.html": "2025-01-01T09:00:00+09:00",
  "https://prtimes.jp/main/html/rd/p/000000002.000000000.html": "2025-01-01T15:00:00+09:00"
}
```

* 読み込み時にキー(URL) の存在有無をチェックし、存在するものは配信済みとみなす。

### 6.2 ログ

* ログ出力内容（例）：
  * 実行開始/終了時刻
  * 取得した記事件数
  * フィルタ後の記事件数
  * Slackへ送信した記事件数
  * エラー内容（例外発生時）
* ログ出力先：
  * 標準出力
  * 必要に応じてログファイル（例：`logs/prtimes_med_it.log`）

---

## 7. 環境・デプロイ

### 7.1 実行環境

* OS：macOS または Linux
* 言語：Python 3.x
* 必要ライブラリ（例）：
  * `requests`（HTTPリクエスト）
  * `feedparser` または `beautifulsoup4`（RSS/HTML解析）
  * `python-dotenv`（環境変数読み込み・任意）

### 7.2 外部サービス設定

* Slack:
  * 対象ワークスペース：`medliss.slack.com`
  * 対象チャンネル：`<#C09V641HFNX>`
  * Incoming Webhook を作成し、環境変数 `SLACK_WEBHOOK_URL` として設定する。

### 7.3 スケジューリング設定

* `crontab` 設定例：

```cron
0 9,15,21 * * * /usr/bin/python3 /path/to/main.py >> /var/log/prtimes_med_it.log 2>&1
```

---

## 8. 将来拡張案

| 項目 | 内容 |
| --- | --- |
| Thread 投稿対応 | 1日1つのスレッドを立て、そのスレッドに返信として記事をぶら下げる形に拡張。 |
| Notion/DB 連携 | Slackだけでなく Notion や RDB に記事を保存し、後から検索・分析できるようにする。 |
| スコアリング | タイトルのキーワード頻度などから「重要度スコア」を算出し、並び順を調整。 |
| メディア追加 | PR TIMES 以外の日本語メディア（ニュースサイト等）のRSSも統合。 |
| メトリクス収集 | クリック数や反応数を別途記録し、どの領域のニュースがよく読まれているか分析。 |

---

## 9. 運用上の注意・確認項目

### 9.1 初期導入時の注意

* 初回実行時に「過去の大量記事」を一括取得しないよう注意する。
  * 対策例：
    * 初回だけ「最新数件」に限定して処理する。
    * 初回はあえて何も送信せず、「現在時刻以降の新着のみ」を対象とする仕様にする。

### 9.2 定期メンテナンス

* 月1回程度、以下を確認する：
  * PR TIMES のRSS仕様変更有無
  * ログサイズが肥大化していないか
  * 保存している配信済みURLデータが過剰に増えていないか

### 9.3 チェックリスト（導入前）

* [ ] Slack Incoming Webhook が作成されている
* [ ] 環境変数 `SLACK_WEBHOOK_URL` が設定されている
* [ ] RSS URL が正しく設定されている
* [ ] 医療系・IT系キーワードの初期セットが妥当である
* [ ] テスト実行で Slack に想定どおり投稿されることを確認済み
* [ ] `cron` または同等のスケジューラ設定が反映されている

---

**以上**
